parameters:
  configuration: 'Release'
  platform: ''
  additionalBuildArguments: ''
  minimumExpectedTestsExecutedCount: 10  # Sanity check for minimum expected tests to be reported
  rerunPassesRequiredToAvoidFailure: 5

jobs:
- job: BuildJob
  displayName: Build ${{ parameters.platform }} ${{ parameters.configuration }}
  variables:
    BuildConfiguration: ${{ parameters.configuration }}
    BuildPlatform: ${{ parameters.platform }}
  pool: { vmImage: windows-2019 }

  steps:
  - template: build-console-steps.yml
    parameters:
      additionalBuildArguments: ${{ parameters.additionalBuildArguments }}

# - template: MUX-RunHelixTests-Job.yml
  # parameters:
    # name: 'RunTestsInHelix'
    # dependsOn: BuildJob
    # condition: succeeded()
    # testSuite: 'DevTestSuite'
    # rerunPassesRequiredToAvoidFailure: ${{ parameters.rerunPassesRequiredToAvoidFailure }}
    
# - template: MUX-ProcessTestResults-Job.yml
  # parameters:
    # dependsOn:
    # - RunTestsInHelix
    # rerunPassesRequiredToAvoidFailure: ${{ parameters.rerunPassesRequiredToAvoidFailure }}
    # minimumExpectedTestsExecutedCount: ${{ parameters.minimumExpectedTestsExecutedCount }}